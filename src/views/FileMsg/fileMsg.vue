<template>
  <div style="overflow: hidden">
    <!--文件管理抬头-->
    <file-header :fileUrlArr="fileUrlArr"></file-header>

    <!--左侧树-->
    <el-col :span="4" class="leftTree">
      <left-tree :treeData="treeData" class="leftTreeContent"></left-tree>
    </el-col>

    <!--右侧文件-->
    <el-col :span="20">
      <div @dragover="fileDragover" @drop="fileDrop" class="fileContent" @click="cleanChecked()" @contextmenu.prevent="nullRightMenuShow" >
        <!--图形形式-->
        <right-file-img v-show="imgOrTable" :fileList="fileList" @fileRightMenuShow="fileRightMenuShow"></right-file-img>
        <!--列表形式-->
        <right-file-table v-show="!imgOrTable" :fileList="fileList" @fileRightMenuShow="fileRightMenuShow"></right-file-table>
      </div>
    </el-col>

    <!--文件管理转换页尾-->
    <file-footer :imgOrTable="imgOrTable" @imgOrTableSet="imgOrTableSet"></file-footer>

    <!--点击文件，出现右击菜单-->
    <Contextmenu ref="fileRightMenu" class="context-menu">
      <li @click="test1" class="el-icon-view"><span>预览</span></li>
      <li @click="test2" class="el-icon-edit"><span>重命名</span></li>
      <li @click="cleanChecked" class="el-icon-delete"><span>删除</span></li>
    </Contextmenu>
    <!--点击空白，出现右击菜单-->
    <Contextmenu ref="nullRightMenu" class="context-menu">
      <li @click="test2" class="el-icon-refresh"><span>刷新</span></li>
      <li @click="test1" class="el-icon-folder-add"><span>新建文件夹</span></li>
    </Contextmenu>
  </div>
</template>

<script>
import fileHeader from '@/views/FileMsg/components/fileHeader' //抬头
import leftTree from '@/views/FileMsg/components/leftTree' //左侧树
import fileList from '@/api/FileMsg/fileList' //右侧文件--模拟数据
import rightFileImg from '@/views/FileMsg/components/rightFileImg' //右侧文件--图片展示
import rightFileTable from '@/views/FileMsg/components/rightFileTable' //右侧文件--列表展示
import fileIconKeyValue from '@/api/FileMsg/fileIconKeyValue' //右侧文件--图片图标
import fileFooter from '@/views/FileMsg/components/fileFooter' //页尾
import Contextmenu from 'vue-context-menu'//右键菜单

export default {
  name: 'fileMsg',
  components: {
    fileHeader,leftTree,rightFileImg,rightFileTable,fileFooter,Contextmenu
  },
  data () {
    return {
      //树的数据
      treeData:[
        {label: "我的调研", open: true, children: [{label: "基础信息"}]},
        {label: "你的调研", open: true, children: [{label: "采集系统"}, {label: "收集系统"}]},
        {label: "一级 3", open: true, children: [{label: "二级 3-1"}, {label: "二级 3-2"}]}
        ],
      fileList: fileList,//文件数据集
      imgOrTable:true,//图形形式|列表形式转换参数(默认是图片形式)
      operationObj:{},//操作对象
      fileUrlArr:[  //文件路径--所有对象
        {id:'1',name:'Users'},
        {id:'2',name:'82060'},
        {id:'3',name:'Desktop'},
        {id:'4',name:'ruoyi-ui'},
      ],
    }
  },
  mounted() {
    // console.log(iconKeyValue);
    this.setFileIcon(this.fileList);
  },
  methods:{
    //右侧文件--图形形式|列表形式--设置文件图标
    setFileIcon:function(newData){
      for(let item in newData){
        let fileExtension = newData[item].name.split('.').pop().toLowerCase();//获取文件后缀
        for(let key in fileIconKeyValue){
          if(fileExtension == key){
            let icon =fileIconKeyValue[key]
            this.$set(newData[item],'icon',require('@/assets/file/'+icon))
          }
        }
      }
    },
    //右侧文件--图形形式--点击空白，置空图片选中状态
    cleanChecked(){
      this.fileList.forEach(item => {
        item.isChecked = false;
      })
    },
    //页尾--图形形式|列表形式转换方法
    imgOrTableSet(param){
      this.imgOrTable = param;
    },
    test1(){console.log("test11111111111111")},
    test2(){console.log("test22222222222222")},

    //点击空白，出现右击菜单
    nullRightMenuShow() {
      this.cleanChecked();
      this.$refs.nullRightMenu.open()
    },
    //点击文件，出现右击菜单
    fileRightMenuShow(param) {
      this.operationObj = param;
      this.$refs.fileRightMenu.open()
    },
    // 拖拽上传
    fileDragover (e) {
      e.preventDefault()
    },
    fileDrop (e) {
      e.preventDefault()
      const file = e.dataTransfer.files[0] // 获取到第一个上传的文件对象
      console.log(file)
      console.log('拖拽释放鼠标时')

      if (!file) return
      if (file.size > (10 * 1000 * 1000)) {
        return alert('文件大小不能超过10M')
      }
      console.log(iconKeyValue)
      // this.imgListOne.push({
      //   id:'',
      //   name:file.name,
      //   icon:''
      // })
      // this.batchFile = file
      // this.fileName = file.name
    },
  }
}
</script>

<style lang="scss" scoped>
  //左侧树
  .leftTree{
    border-right: rgba(147, 180, 220, 0.35) solid 0.5px;
    height: 90vh;
    .leftTreeContent{
      margin-top: 3vh;
    }
  }
  //文件管理正文
  .fileContent{
    overflow-y: auto;
    height: 90vh;
    margin-left: 2vh;
  }
</style>
